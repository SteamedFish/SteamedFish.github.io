<div class="html">
<p>
&#x2014;
layout: default
title: Emacs 在 .dir-locals.el 中执行 elisp 语句
&#x2014;
</p>

</div>


<p>
在 <code>.dir-locals.el</code> 中可以控制目录级别的变量。这个文件不是一个 elisp 代码文件，
而是只能存放一个 Association List （联合列表，alist）的列表。
</p>

<p>
这个联合列表里面的每个 cons cell 的 car 是希望生效的模式，cdr 则又是一个 alist，
用于给变量赋值。
</p>

<div class="org-src-container">
<pre class="src src-elisp">( <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#19968;&#20010;&#22823;&#21015;&#34920;&#65292;&#37324;&#38754;&#26159;&#24456;&#22810; alist</span>
 (<span style="color: #c678dd;">c-mode</span> . (  <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36825;&#20010; alist &#25511;&#21046; c-mode &#27169;&#24335;&#19979;&#30340;&#34892;&#20026;&#65292;&#20854;&#20013; cdr &#21448;&#26159;&#19968;&#20010; alist</span>
            (c-file-style . <span style="color: #98be65;">"BSD"</span><span style="color: #5B6268;">)</span>
            (subdirs . nil<span style="color: #5B6268;">)</span>
           <span style="color: #5B6268;">)</span>
 <span style="color: #5B6268;">)</span>
 (nil . (     <span style="color: #5B6268;">;; </span><span style="color: #5B6268;">&#36825;&#20010; alist &#23545;&#25152;&#26377; mode &#29983;&#25928;</span>
         (<span style="color: #dcaeea;">indent-tabs-mode</span> . t<span style="color: #5B6268;">)</span>
         (tab-witdh . <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #5B6268;">)</span>
         (<span style="color: #dcaeea;">fill-column</span> . <span style="color: #da8548; font-weight: bold;">80</span><span style="color: #5B6268;">)</span>
        <span style="color: #5B6268;">)</span>
 <span style="color: #5B6268;">)</span>
<span style="color: #5B6268;">)</span>
</pre>
</div>

<p>
那么问题来了，有时候我们希望能够不仅仅是赋值，而是执行 elisp 语句。这个时候我们
不需要赋值，需要的是语句的副作用。我们可以将其赋值给随便一个不需要的变量上，例如
叫 <code>eval</code> 。然后我们就可以这样写：
</p>


<div class="org-src-container">
<pre class="src src-elisp">((<span style="color: #c678dd;">c-mode</span> . ((c-file-style . <span style="color: #98be65;">"BSD"</span><span style="color: #5B6268;">)</span>
            (subdirs . nil<span style="color: #5B6268;">)))</span>
 (nil . ((<span style="color: #dcaeea;">indent-tabs-mode</span> . t<span style="color: #5B6268;">)</span>
         (tab-witdh . <span style="color: #da8548; font-weight: bold;">4</span><span style="color: #5B6268;">)</span>
         (<span style="color: #dcaeea;">fill-column</span> . <span style="color: #da8548; font-weight: bold;">80</span><span style="color: #5B6268;">)</span>
         (<span style="color: #a9a1e1;">eval</span> . (<span style="color: #51afef;">progn</span>
                   (<span style="color: #dcaeea;">flycheck-mode</span> <span style="color: #da8548; font-weight: bold;">1</span><span style="color: #5B6268;">)</span>
                   (xxxxxx<span style="color: #5B6268;">)</span>
                   (xxxxx<span style="color: #5B6268;">))))))</span>
</pre>
</div>

<p>
不过这样会导致 Emacs 在加载这个文件的时候，提示你加载了一个不安全的文件，并且让
你选择究竟是不加载，还是只允许一次，还是永久加载。如果选择永久加载，emacs 会记录
在 <code>custom.el</code> 中。
</p>
